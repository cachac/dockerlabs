# 1. Logs <!-- omit in TOC -->

# 2. Crea una imagen con un script que genera logs

Nombre: log_generator.sh
```sh
#!/bin/bash
while true; do
  timestamp=$(date +"%Y-%m-%d %H:%M:%S")
  echo "[$timestamp] [INFO] Generando línea de log. ¡El disco se está llenando! *********************************** (PID: $$). "

  sleep 0.1
done
```

# 3. Crea una imagen con el script
Nombre: log.dockerfile
```dockerfile
FROM alpine:latest
RUN apk update && apk add bash
WORKDIR /app
COPY log_generator.sh /app/
RUN chmod +x log_generator.sh
CMD ["./log_generator.sh"]
```

# 4. Construye la imagen
```sh
docker build -t log-demo-noisy .
```

# 5. Ejecuta el contenedor
```sh
docker run -d --name log-prueba-rotacion --log-opt max-size=200k --log-opt max-file=2 log-demo-noisy
```

--log-opt max-size=200k: Limita el tamaño de cada archivo de log a 200 kilobytes

--log-opt max-file=2: Conserva un máximo de 2 archivos de log rotados.

# 6. Ver los logs
```sh
docker logs -f log-prueba-rotacion
```


# 7. Verifica el tamaño de los archivos de log
```sh
docker inspect log-prueba-rotacion | grep LogPath
```
/var/lib/docker/containers/<container_id>/

## 7.1. Busca el container ID
```sh
CONTAINER_ID=$(docker inspect -f '{{.Id}}' log-prueba-rotacion)
```

## 7.2. Busca los archivos de log
Revisa los archivos con extension .log.
```sh
watch ls -lh /var/lib/docker/containers/$CONTAINER_ID
```

## 7.3. Elimina el contenedor
```sh
docker rm -f log-prueba-rotacion
```

# 8. Configuración con el Driver local
El driver local también utiliza las opciones max-size y max-file para la rotación.

Por defecto Docker utiliza el driver json-file.

```sh
docker run -d \
  --name log-prueba-driver-local \
  --log-driver=local \
  --log-opt max-size=1m \
  --log-opt max-file=5 \
  log-demo-noisy
```

Al especificar --log-driver=local, Docker utilizará este controlador en lugar del predeterminado json-file. El driver local está diseñado para ser más eficiente en el uso del espacio en disco.

Otros drivers disponibles:
- json-file
- journald
- syslog
- gelf
- fluentd
- awslogs
- etwlogs
- gcplogs
- splunk


# 9. Tambien es posible configurar el driver en el daemon
Crea el archivo /etc/docker/daemon.json
```sh
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "5"
  }
}
```

